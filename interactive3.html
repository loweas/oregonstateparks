<!DOCTYPE html>
<html lang="en">

<head>
  <title>lab 3</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="please add">
  <!-- CSS Base -->
  <link rel="stylesheet" type='text/css' media='all' href="css/webslides.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="all" href="css/style.css">
  <style>
  #info {
position: fixed;
z-index: 1000;
bottom: 20px;
right: 10px;
width: 768px;
color: #333333;
padding: 6px 8px;
background: rgba(225, 225, 225, 0.5);
box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
border-radius: 5px;
}
  </style>
  <!-- Javascript Library -->
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="js/webslides.min.js"></script>
  <script src="https://unpkg.com/d3@5/dist/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.js"></script>
</head>

<body>
  <article id="webslides">
    <section>
      <video class="background-video" autoplay muted loop>
        <source src="assets/smithrock.mp4" type="video/mp4">
      </video>
      <div class="wrap aligncenter">
        <h1>
          <strong>Smith Rock State Park</strong>
        </h1>
      </div>
    </section>
    <section class="bg-apple">
      <div id="mymap2"></div>
    </section>
    <!-- the map -->
    <!-- refer to https://webslides.tv/demos/components#slide=15 -->
    <!-- refer to https://webslides.tv/demos/components#slide=1 -->
    <section class="bg-apple slide-top">
      <div id="mymap"></div>
      <div class="wrap">
        <div class="content-left">
          <div id="info">
           <div id="chart"></div>
           <div id="chart2"></div>
        </div>
        </div>
      </div>
    </section>

  </article>
  <script>
    // make the web slide object.
    var ws = new WebSlides();
    // decalre the second map object
    var map2 = L.map("mymap2", {
      zoomControl: false,
      scrollWheelZoom: false
    }).setView([44.3682, -121.1406], 7);


    L.tileLayer('https://api.mapbox.com/styles/v1/loweas/cjv4ijme33cv51fo88tiywo86/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibG93ZWFzIiwiYSI6ImNqczlhMzJqMjE1dDM0NG12dHBxam1lZjIifQ.Ox8goYypCr_cJCoDPgHTsQ', {
      maxZoom: 19
    }).addTo(map2);

    var map = L.map("mymap", {
      zoomControl: false,
      scrollWheelZoom: false
    }).setView([44.3682, -121.1406], 7); // fitBounds will fit the map to the boundary of the viewport (monitor)

    // add a basemap for the second map
    L.tileLayer('https://api.mapbox.com/styles/v1/loweas/cjv4ijme33cv51fo88tiywo86/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibG93ZWFzIiwiYSI6ImNqczlhMzJqMjE1dDM0NG12dHBxam1lZjIifQ.Ox8goYypCr_cJCoDPgHTsQ', {
      maxZoom: 19
    }).addTo(map);

    // L.marker([45.514685, -122.987080]).addTo(map)
    // .bindPopup('')
    // .openPopup();





    // bind a function to the slide change event of web slides
    ws.el.addEventListener('ws:slide-change', function() {
      // capture all the div under the currently displaying section
      crtDiv = $(".current div");
      if (crtDiv.attr("id") === "mymap2") {
        map2.invalidateSize();
        //starting location latitude and longitude
        map2.setView([45.514685, -122.987080], 7);
        //Fly to animation  new latitude and longitude
        map2.flyTo([44.366, -121.134], 15, {
          animate: true,
          duration: 10
        });
      }
      else if (crtDiv.attr("id") === "mymap") {
        // Checks if the map container size changed and updates the map if so
        map.invalidateSize();

        map.setView([44.366, -121.134], 15);
        Promise.all([
          d3.csv('assets/smithnum.csv')
        ]).then(function(datasets) {
        var t = ["t"];
        var Booth = ["Booth"];
        var Prineville = ["Prineville"];
        var LakeOwyhee = ["LakeOwyhee"];
        var HatRock = ["HatRock"];
        var Ochoco = ["Ochoco"];
        var FortRock = ["FortRock"];
        var JosephStewart = ["JosephStewart"];
        var SmithRock = ["SmithRock"];
        var Tumalo = ["Tumalo"];
        var GooseLake = ["GooseLake"];
        var WhiteRiverFalls = ["WhiteRiverFalls"];
        var PilotButte = ["PilotButte"];
        var RedBridge = ["RedBridge"];
        var Sumpter = ["Sumpter"];
        var ClydeHolliday = ["ClydeHolliday"];
        var Minam = ["Minam"];
        var PeterSkene = ["PeterSkene"];
        var BattleMountain = ["BattleMountain"];
        var Lapine = ["Lapine"];
        var ClineFalls = ["ClineFalls"];
        var DeshutesRiver = ["DeshutesRiver"];
        var Collier = ["Collier"];
        var ValleyofRogue = ["ValleyofRogue"];
        var EmigrantSprings = ["EmigrantSprings"];



        datasets[0].forEach(function(d) {
          t.push(new Date(d["t"]));
          Booth.push(+d["Booth"]);
          Prineville.push(+d["Prineville"]);
          LakeOwyhee.push(+d["LakeOwyhee"]);
          HatRock.push(+d["HatRock"]);
          Ochoco.push(+d["Ochoco"]);
          FortRock.push(+d["FortRock"]);
          JosephStewart.push(+d["JosephStewart"]);
          SmithRock.push(+d["SmithRock"]);
          Tumalo.push(+d["Tumalo"]);
          GooseLake.push(+d["GooseLake"]);
          WhiteRiverFalls.push(+d["WhiteRiverFalls"]);
          PilotButte.push(+d["PilotButte"]);
          RedBridge.push(+d["RedBridge"]);
          Sumpter.push(+d["Sumpter"]);
          ClydeHolliday.push(+d["ClydeHolliday"]);
          Minam.push(+d["Minam"]);
          PeterSkene.push(+d["PeterSkene"]);
          BattleMountain.push(+d["BattleMountain"]);
          Lapine.push(+d["Lapine"]);
          ClineFalls.push(+d["ClineFalls"]);
          DeshutesRiver.push(+d["DeshutesRiver"]);
          Collier.push(+d["Collier"]);
          ValleyofRogue.push(+d["ValleyofRogue"]);
          EmigrantSprings.push(+d["EmigrantSprings"]);

        });

        var chart = c3.generate({
          bindto: "#chart",
          title: {
            text: 'Visitation to Smith Rock State Park'
          },
          data: {
            x: 't',
            columns: [t, SmithRock],
            type: 'spline',
          },
          subchart: {
            show: true,
            size: {
              height: 15
            },
            onbrush: function(d) {
              chart2.zoom(chart.zoom());
            }
          },
          axis: {
            x: {
              type: 'timeseries',
              tick: {
                format: '%Y'
              }
            },
            y: {
              label: {
                text: '# of Yearly Vists',
                position: 'outer-middle'
              }
            },
          },
          point: {
            r: 0,
            focus: {
              expand: {
                r: 2
              }
            }
          },
          zoom: {
            // rescale: true,+
            enabled: true,
            type: "scroll",
            onzoom: function(d) {
              chart2.zoom(chart.zoom());
              // step();
            }
          },
          stanford: {
            scaleMin: 1,
            scaleMax: 10000,
            scaleFormat: 'pow10',
            padding: {
              top: 15,
              right: 0,
              bottom: 0,
              left: 0
            }

          },
        });

        var chart2 = c3.generate({
          bindto: "#chart2",
          title: {
            text: 'Regional Visitation in the Mountains'
          },
          data: {
            x: 't',
            columns: [t, Booth, Prineville, LakeOwyhee, HatRock, Ochoco, FortRock, JosephStewart, SmithRock, Tumalo, GooseLake, WhiteRiverFalls, PilotButte, RedBridge, Sumpter, ClydeHolliday, Minam, PeterSkene, BattleMountain, Lapine,
              ClineFalls, DeshutesRiver, Collier, ValleyofRogue, EmigrantSprings
            ],
            type: 'spline',
          },
          axis: {
            x: {
              type: 'timeseries',
              tick: {
                format: '%Y'
              }
            },
            y: {
              tick: {
                format: ''
              },
              label: {
                text: '# of Visits',
                position: 'outer-middle'
              }
            },
          },
          point: {
            r: 0,
            focus: {
              expand: {
                r: 2
              }
            }
          },
          zoom: {
            enabled: {
              type: "drag"
            },
            onzoomend: function(d) {
              chart.zoom(chart2.zoom());
            }
          },
          tooltip: {
            linked: true
          },
        });

      });
        chart.resize({
          height: 250,
          width: 500
        });
        chart2.resize({
          height: 250,
          width: 500
        });
      }


    });
  </script>
</body>

</html>
